define(["./normalize"],function(normalize){if("undefined"==typeof window)return{load:function(n,r,load){load()}};var head=document.getElementsByTagName("head")[0],progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],get=function(url,callback,errback){var xhr,i,progId;if("undefined"!=typeof XMLHttpRequest)xhr=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(i=0;3>i;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}xhr.open("GET",url,requirejs.inlineRequire?!1:!0),xhr.onreadystatechange=function(){var status,err;4===xhr.readyState&&(status=xhr.status,status>399&&600>status?(err=Error(url+" HTTP status: "+status),err.xhr=xhr,errback(err)):callback(xhr.responseText))},xhr.send(null)},cssAPI={};cssAPI.pluginBuilder="./css-builder";var stylesheet=document.createElement("style");stylesheet.type="text/css",head.appendChild(stylesheet),cssAPI.inject=stylesheet.styleSheet?function(css){stylesheet.styleSheet.cssText+=css}:function(css){stylesheet.appendChild(document.createTextNode(css))},cssAPI.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0};var instantCallbacks={};return cssAPI.normalize=function(name,normalize){var instantCallback;return"!"==name.substr(name.length-1,1)&&(instantCallback=!0),instantCallback&&(name=name.substr(0,name.length-1)),".css"==name.substr(name.length-4,4)&&(name=name.substr(0,name.length-4)),name=normalize(name),instantCallback&&(instantCallbacks[name]=instantCallback),name},cssAPI.load=function(cssId,req,load,config,parse){var instantCallback=instantCallbacks[cssId];instantCallback&&delete instantCallbacks[cssId];var fileUrl=cssId;if(".css"==fileUrl.substr(fileUrl.length-4,4)||parse||(fileUrl+=".css"),fileUrl=req.toUrl(fileUrl),"http://"==fileUrl.substr(0,7)||"https://"==fileUrl.substr(0,8)){if(parse)throw"Cannot preprocess external css.";var link=document.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=fileUrl,head.appendChild(link),load(cssAPI)}else get(fileUrl,function(css){parse&&(css=parse(css));var pathname=window.location.pathname.split("/");pathname.pop(),pathname=pathname.join("/")+"/","/"!=fileUrl.substr(0,1)&&(fileUrl="/"+normalize.convertURIBase(fileUrl,pathname,"/")),css=normalize(css,fileUrl,pathname),cssAPI.inject(css),instantCallback||load(cssAPI)}),instantCallback&&load(cssAPI)},cssAPI});