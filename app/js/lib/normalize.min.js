define(["require","module"],function(){function convertURIBase(uri,fromBase,toBase){return uri.match(/^\/|([^\:\/]*:)/)?uri:relativeURI(absoluteURI(uri,fromBase),toBase)}function absoluteURI(uri,base){"./"==uri.substr(0,2)&&(uri=uri.substr(2));var baseParts=base.split("/"),uriParts=uri.split("/");for(baseParts.pop();curPart=uriParts.shift();)".."==curPart?baseParts.pop():baseParts.push(curPart);return baseParts.join("/")}function relativeURI(uri,base){var baseParts=base.split("/");for(baseParts.pop(),base=baseParts.join("/")+"/",i=0;base.substr(i,1)==uri.substr(i,1);)i++;for(;"/"!=base.substr(i,1);)i--;base=base.substr(i+1),uri=uri.substr(i+1),baseParts=base.split("/");var uriParts=uri.split("/");for(out="";baseParts.shift();)out+="../";for(;curPart=uriParts.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var normalizeCSS=function(source,fromBase,toBase){for(var result,url,source,urlRegEx=/(url\(\s*"(.*)"\s*\))|(url\(\s*'(.*)'\s*\))|(url\(\s*(.*)\s*\))/g;result=urlRegEx.exec(source);){url=result[2]||result[4]||result[6];var newUrl=convertURIBase(url,fromBase,toBase),quoteLen=result[2]||result[4]?1:0;source=source.substr(0,urlRegEx.lastIndex-url.length-quoteLen-1)+newUrl+source.substr(urlRegEx.lastIndex-quoteLen-1),urlRegEx.lastIndex=urlRegEx.lastIndex+(newUrl.length-url.length)}for(var importRegEx=/(@import\s*'(.*)')|(@import\s*"(.*)")/g;result=importRegEx.exec(source);){url=result[2]||result[4];var newUrl=convertURIBase(url,fromBase,toBase);source=source.substr(0,importRegEx.lastIndex-url.length-1)+newUrl+source.substr(importRegEx.lastIndex-1),importRegEx.lastIndex=importRegEx.lastIndex+(newUrl.length-url.length)}return source};return normalizeCSS.convertURIBase=convertURIBase,normalizeCSS});